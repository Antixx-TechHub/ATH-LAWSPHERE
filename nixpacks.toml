# Nixpacks configuration for Railway - Monorepo setup
[phases.setup]
nixPkgs = ["nodejs_20", "openssl"]

[phases.install]
cmds = ["npm ci"]

[phases.build]
cmds = [
  "echo '=== BUILD PHASE ==='",
  "echo 'DATABASE_URL available:' ${DATABASE_URL:+yes}",
  "cd apps/web && npx prisma generate",
  "cd apps/web && npm run build",
  "echo '=== BUILD COMPLETE ==='",
]

[start]
cmd = "cd apps/web && echo '=== RUNTIME START ===' && echo 'DATABASE_URL:' ${DATABASE_URL:+SET} && echo 'NEXTAUTH_URL:' $NEXTAUTH_URL && node server.js"

# Ensure environment variables are available at runtime
[variables]
NODE_ENV = "production"
NIXPACKS_NODE_VERSION = "20"
